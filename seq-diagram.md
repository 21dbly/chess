https://sequencediagram.org/index.html#initialData=IYYwLg9gTgBAwgGwJYFMB2YBQAHYUxIhK4YwDKKUAbpTngUSWDABLBoAmCtu+hx7ZhWqEUdPo0EwAIsDDAAgiBAoAzqswc5wAEbBVKGBx2ZM6MFACeq3ETQBzGAAYAdAA5M9qBACu2AMQALADMbgBMAJwgMP7I9gAWYDoIPoYASij2SKoWckgQaJiIqKQAtAB85JQ0UABcMADaAAoA8mQAKgC6MAD0PgZQADpoAN4ARP2UaMAAtihjtWMwYwA0y7jqAO7QHAtLq8soM8BICHvLAL6YwjUwFazsXJT145NQ03PnB2MbqttQu0WyzWYyOJzOQLGVzYnG4sHuN1E9SgmWyYEoAAoMlkcpQMgBHVI5ACU12qojulVk8iUKnU9XsKDAAFUBhi3h8UKTqYplGpVJSjDpagAxJCcGCsyg8mA6SwwDmzMQ6FHAADWkoGME2SDA8QVA05MGACFVHHlKAAHmiNMY7vcebT+fUpVAeZhHXz1PbKoiVC6Bu6-YZSgjqs8YApTShgOb2ur0ABRS0qbAEApk6iUH3wZDmeqBJzBYbjObqYCMhbLRNQbx1A1TJXG6Ox+XyNXoKFmTiaHQ5z101T1NA+BAID3aJ3e0O+8n+mAjseZqgUh2Tr1DkCq9Gu9mB7Tc9eDwXGWoKDgcTXS7TL1dUo-Orcx9EKHx6jHAN-xHmHmkbk-Cuel6vnqQZziG9wwk89bYmieJqKOWBQXCOY3BGryGkqSz1PsIKfnq7QQB2aDYcslzLtmM65iUYD1GEThOCWEyYZ8MA4cCyz4fEhHEaR+xXOgHCmF4vgBNA7CMjEIpwIm0hwAoMAADIQFkhTFOYgpofWzRtF0vQGOo+RoCWipzGsvz-BwVxaYKyHoaZKDmfofw7NCjwoWGIjzspqkYj54oEkSYCksGgoDs6MCMiybIOb+vLHvcp5ihKroynKDbvEqmAqjGGqutqur6g5RgQGoC4QMwVpor2-YPvSC6juO4XTp5K7zou46hVRWn1AAkmgIDQCi4CupyyapumhQ2VR6kYAWTgAIxMWWqgVvMOE1nW9TFRwpUCmgFUwFVORdoJNVUc1Q5Xm6N6Xah4EBte8jZaqGrioNtYoOAMAWTst4qPdWb1sy0xftASAAF4oBw40oGmRkUfC9yzbRMCFktoxjCta1VmMm3QNtoN6uDUO7AJPZdfef6DrUT5yCgIHxB+X4-hO1P8gBZ4XpGLM3l1kHuRG-loBkqiIZgdlI7OQMvMxjasex3xcTxnZsWRXbTcjeZzTA9GMZjDl8RxYzK0RquK+TQmeN4fj+F4KDoDEcSJPbjs+b4WAo5p4badIiaKYm7SJt0PQGaoRnDKbxGI7Zgv1lH6AS3H3teSg9Tu2+GKMyraAheBYV1VdKIzBANCMzyzMEWbuds-FHOJcKGQlzQPOgdosrygnhQ5eqMD9VQJpIMBX45+da7s-VABm4K11OArdQ9MDT6c-0QdLNQukT8Qk9DsPwxmmuVCj80Y6W-I4xttYEwqW872T3ZCXaF2F-UYsbrP-4L6nr8+O--OVJLH+79JaAw3jAEY1kfY5mPrrBiJYrgP2EjbAIKJLz+GwOKDUik0QwAAOJKg0F7VqEYGi4MDiHewSpI4j2rjHAWsIIxdyTgw+E68kRKTRPgssWcaHETzqnAuE8rpcR3pXbi1c4pz05slYebd5Ad2NLwxOPcNT90HrI8R0cn7jzrvVDqH8EqtXYcvTq+cv5gJBiIqAkNd4pjhpNOhWsaIn2WufSsl8to3ysTY++Z1tFU10Vdcut1C6gPYW-Qcq9BGBIZEyLhagMSSM-pUU8MAZGRjHHgghY8Alz3qKQpUMpkA5E6AY+uRj5wFLmEUtEpT-4PBYenThBDRbixAeY9CVSUA1JKZAoG0Dtaoz1iWLpPSwCdEtkg0S-gOAAHYIhOBQE4GIiZghwBkgANngNuQw8SYBFEGSnMBOkOgUKoVvHOJZKFzAAHJKj6bceh0F6hMPaWw+ccAdnxIxJ858KB4mBTUMFKJOi8mKOJtYqGYic5JISik4U6TgnyPSkwlRfc0AD2QBo0e-iZAvwakuO65jjEz3qT1SUt9IW2ImgjQ+1F8xo0Wq48s7jqxX3rD4SlPjTo9lxZdeoSLgBlJau8tOMAIn8hBbkjc9Q6bom+dclAdy5iwvrvC+ovz6ZZLmAVPUkUlTKrEHy-F8T3REoqWKxVvVpAgqeXCDVXylStIQEhZOHT6wjCtdIeoC0wjBECA8yiTiGXDNGF6n1fqA2IOttMywKAxwQE2E7JACQwBxoTUmgAUhAcU2rDD+GSKANUByaJHJIU0ZkekeiKuoVXYiJZsAIGAHGqAcAIAIGgGsL1gbWENOeeCzR6AG1NpbW2jtUAu1KmtW5FhRz2HZvFN8hdaAAUoEJEC-hbUQzSppgO0RXdVXTnVYi3myLO5KO7q9dFmKh6t0HYUY1QjhyNWFfPC19QTG2vXhGSxYMqUwzsfvKaUCZqDJcZjbGrK8bssJt40mPLH59mfk+u9ZrQnEvnBK9QUq8Uoaigqqd0hD3z3VWk8Ul49npS9S9XKMBxQ3svNRx9MSCVNXQ++1jX6qgyzzdIPaNyKrJjRHvBxdKYGFmLBBtx602WeMVSVMqB1KrWhOpM5jYLTUhKEWE+cmnnposVT0Qa47mxmjbAmYDAj3X1HifGYiInaUgeDTrCTPQpMspk9BzxJozMwHbJ2SZlNcMsb8FoeVSoMRerWLFV9nNJTYDC7spsVHCPDB1HqhyXHAHit-pE9pxCPU9oGc42B+sIHRpErbLwzbk2puq-KRAMZYDAGwI2wgeQCj7KId+32-tA7B16MYOhAC471GYdBOd84QDcDwIknD-KYDTaa3Nol6qm6l0MCgGolg9TinsDk4LYKsMaHNaKoBkT6nZeO+NjyBWXhFdAyV0N5WzpAA
```
actor Client
participant Server
participant Handler
participant Service
participant DataAccess
database db

entryspacing 0.8
group#43829c #lightblue Registration
Client -> Server: [POST] /user\n{"username":" ", "password":" ", "email":" "}
Server -> Handler: {"username":" ", "password":" ", "email":" "}
Handler -> Service: register(RegisterRequest)
Service -> DataAccess: getUser(username)
DataAccess -> db:Find UserData by username
break User with username already exists
db --> DataAccess: UserData
DataAccess --> Service: UserData
Service --> Server: AlreadyTakenException
Server --> Client: 403\n{"message": "Error: username already taken"}
end
db --> DataAccess: null
DataAccess --> Service: null
Service -> DataAccess:createUser(userData)
DataAccess -> db:Add UserData
Service -> DataAccess:createAuth(authData)
DataAccess -> db:Add AuthData
Service --> Handler: RegisterResult
Handler --> Server: {"username" : " ", "authToken" : " "}
Server --> Client: 200\n{"username" : " ", "authToken" : " "}
end

group#orange #FCEDCA Login
Client -> Server: [POST] /session\n{username, password}
Server -> Handler: {username, password}
Handler -> Service: Login(LoginRequest)
Service -> DataAccess: getUser(username)
DataAccess -> db:Find UserData by username
break User with username does not exist
db --> DataAccess: null
DataAccess --> Service: null
Service --> Server: IncorrectUsernameException
Server --> Client: 401\n{"message": "Error: username does not exist"}
end
db --> DataAccess: UserData
DataAccess --> Service: UserData
break incorrect password
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: unauthorized"}
end
Service -> DataAccess:createAuth(authData)
DataAccess -> db:Add AuthData
Service --> Handler: LoginResult
Handler --> Server: {"username" : " ", "authToken" : " "}
Server --> Client: 200\n{"username" : " ", "authToken" : " "}
end

group#green #lightgreen Logout
Client -> Server: [DELETE] /session\nauthToken
Server -> Handler: authToken
Handler -> Service: Logout(AuthToken)
Service -> DataAccess: removeAuthData(authToken)
DataAccess -> db:Remove AuthData by authToken
break Invalid AuthToken
db --> DataAccess: fail
DataAccess --> Service: fail
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: unauthorized"}
end
db --> DataAccess: success
DataAccess --> Service: success
Service --> Handler: success
Handler --> Server: {}
Server --> Client: 200\n{}

end

group#red #pink List Games
Client -> Server: [GET] /game\nauthToken
Server -> Handler: authToken
Handler -> Service: ListGames(AuthToken)
Service -> DataAccess: authorize(authToken)
DataAccess -> db:Find AuthData by authToken
break Invalid AuthToken
db --> DataAccess: null
DataAccess --> Service: fail
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: unauthorized"}
end
db --> DataAccess: AuthData
DataAccess --> Service: success
Service -> DataAccess: getGames()
DataAccess -> db: Find All Games
db --> DataAccess: [GameData list]
DataAccess --> Service: [GameData list]
Service --> Handler: ListGamesResult
Handler --> Server: {[GameData list]}
Server --> Client: 200\n{[GameData list]}
end

group#d790e0 #E3CCE6 Create Game 
Client -> Server: [POST] /game\nauthToken\n{gameName}
Server -> Handler: authToken
Handler -> Service: CreateGame(CreateGameRequest)
Service -> DataAccess: authorize(authToken)
DataAccess -> db:Find AuthData by authToken
break Invalid AuthToken
db --> DataAccess: null
DataAccess --> Service: fail
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: unauthorized"}
end
db --> DataAccess: AuthData
DataAccess --> Service: success
Service -> DataAccess: createGame(gameName)
DataAccess -> db: Create Game with gameName
db --> DataAccess: GameData
DataAccess --> Service: gameID
Service --> Handler: CreateGameResult
Handler --> Server: {gameID: 1234}
Server --> Client: 200\n{gameID: 1234}
end

group#yellow #lightyellow Join Game #black
Client -> Server: [PUT] /game\nauthToken\n{playerColor, gameID}
Server -> Handler: authToken\n{playerColor, gameID}
Handler -> Service: JoinGame(JoinGameRequest)
Service -> DataAccess: authorize(authToken)
DataAccess -> db:Find AuthData by authToken
break Invalid AuthToken
db --> DataAccess: null
DataAccess --> Service: fail
Service --> Server: UnauthorizedException
Server --> Client: 401\n{"message": "Error: unauthorized"}
end
db --> DataAccess: AuthData
DataAccess --> Service: success
Service -> DataAccess: getGame(gameID)
DataAccess -> db: Find Game by gameID
break invalid gameID
db --> DataAccess: null
DataAccess --> Service: null
Service --> Server: GameDoesNotExistException
Server --> Client: 403\n{"message": "Error: game does not exist"}
end
db --> DataAccess: GameData
DataAccess --> Service: GameData
break game/color already taken
Service --> Server: GameTakenException
Server --> Client: 403/n{"message": "Error: already taken"}
end
Service -> DataAccess: updateGame(gameID, username)
DataAccess -> db: Update Game by gameID\nwith username
Service --> Handler: success
Handler --> Server: {}
Server --> Client: 200\n{}
end

group#gray #lightgray Clear application 
Client -> Server: [DELETE] /db
Server -> Handler: 
Handler -> Service: clear()
Service -> DataAccess: clear()
DataAccess -> db:Remove everything
db --> DataAccess: success
DataAccess --> Service: success
Service --> Handler: success
Handler --> Server: {}
Server --> Client: 200\n{}
end
```